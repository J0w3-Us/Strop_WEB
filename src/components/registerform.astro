---
// Formulario de registro con validaciones b√°sicas
import { register } from "../service/auth.service";
---

<form id="register-form">
  <div class="form-group">
    <label for="fullName">Nombre Completo</label>
    <input
      type="text"
      id="fullName"
      name="fullName"
      placeholder="Introduce su nombre completo"
      required
    />
  </div>

  <div class="form-group">
    <label for="email">Correo Electr√≥nico</label>
    <input
      type="email"
      id="email"
      name="email"
      placeholder="Introduce su correo electr√≥nico"
      required
    />
  </div>

  <div class="form-group" style="position:relative">
    <label for="password">Contrase√±a</label>
    <input
      type="password"
      id="password"
      name="password"
      placeholder="Introduce su contrase√±a"
      required
    />
    <button
      type="button"
      id="toggle-show-pwd"
      style="position:absolute;right:14px;top:44px;border:0;background:transparent;cursor:pointer"
      >üëÅÔ∏è</button
    >
  </div>

  <div class="form-group" style="position:relative">
    <label for="confirmPassword">Confirmar Contrase√±a</label>
    <input
      type="password"
      id="confirmPassword"
      name="confirmPassword"
      placeholder="Confirme su contrase√±a"
      required
    />
    <button
      type="button"
      id="toggle-show-confirm"
      style="position:absolute;right:14px;top:44px;border:0;background:transparent;cursor:pointer"
      >üëÅÔ∏è</button
    >
  </div>

  <div style="margin:16px 0">
    <label
      style="display:flex;align-items:flex-start;gap:10px;font-size:0.9rem;line-height:1.4"
    >
      <input type="checkbox" id="terms" required style="margin-top:2px" />
      <span
        >Acepto los <a href="#" style="color:#fb923c;text-decoration:none"
          >T√©rminos y Condiciones</a
        > y la <a href="#" style="color:#fb923c;text-decoration:none"
          >Pol√≠tica de Privacidad</a
        >.</span
      >
    </label>
  </div>

  <p id="error-message" class="error"></p>

  <button type="submit" class="btn-primary">Crear Cuenta</button>

  <div
    style="display:flex;align-items:center;gap:12px;margin:20px 0;align-items:center"
  >
    <hr style="flex:1;border:none;border-top:1px solid #e2e8f0" />
    <small style="color:#94a3b8">O reg√≠strate con:</small>
    <hr style="flex:1;border:none;border-top:1px solid #e2e8f0" />
  </div>

  <button type="button" class="btn-google" id="btn-google-register">
    <span style="width:18px;height:18px;display:inline-block">G</span>
    <span>Continuar con Google</span>
  </button>

  <p style="text-align:center;margin-top:16px;font-size:0.9rem;color:#64748b">
    ¬øYa tienes una cuenta? <a
      href="/login"
      style="color:#fb923c;text-decoration:none">Inicia Sesi√≥n</a>
  </p>
</form>

<script>
  // Importamos la l√≥gica del servicio (stub)
  import { register } from "../service/auth.service";

  document
    .getElementById("register-form")
    ?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target as HTMLFormElement;
      const formData = new FormData(form);
      const fullName = formData.get("fullName") as string;
      const email = formData.get("email") as string;
      const password = formData.get("password") as string;
      const confirmPassword = formData.get("confirmPassword") as string;

      const errorEl = document.getElementById("error-message");
      const submitBtn = form.querySelector(
        'button[type="submit"]'
      ) as HTMLButtonElement;

      if (!errorEl || !submitBtn) return;

      // Validaciones b√°sicas
      if (password !== confirmPassword) {
        errorEl.textContent = "Las contrase√±as no coinciden";
        return;
      }

      if (password.length < 6) {
        errorEl.textContent = "La contrase√±a debe tener al menos 6 caracteres";
        return;
      }

      // L√≥gica de carga
      errorEl.textContent = "";
      submitBtn.disabled = true;
      submitBtn.textContent = "Creando cuenta...";

      try {
        // 1. Llama al servicio
        const result = await register({ fullName, email, password });
        // 2. Si tiene √©xito, redirige
        window.location.href = result.redirectUrl || "/login";
      } catch (err) {
        // 3. Si falla, muestra el error
        errorEl.textContent = (err as Error).message;
        submitBtn.disabled = false;
        submitBtn.textContent = "Crear Cuenta";
      }
    });

  // Toggle password visibility
  document.getElementById("toggle-show-pwd")?.addEventListener("click", () => {
    const pwd = document.getElementById("password") as HTMLInputElement | null;
    if (!pwd) return;
    pwd.type = pwd.type === "password" ? "text" : "password";
  });

  document
    .getElementById("toggle-show-confirm")
    ?.addEventListener("click", () => {
      const confirm = document.getElementById(
        "confirmPassword"
      ) as HTMLInputElement | null;
      if (!confirm) return;
      confirm.type = confirm.type === "password" ? "text" : "password";
    });

  // Google button - placeholder
  document
    .getElementById("btn-google-register")
    ?.addEventListener("click", () => {
      alert("Google sign-up placeholder");
    });
</script>

<style>
  .error {
    color: #dc2626;
    margin: 8px 0;
  }
</style>
