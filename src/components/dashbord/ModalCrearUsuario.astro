<!-- Modal Crear Usuario -->
<div class="modal-overlay" id="modalCrearUsuario">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Crear Nuevo Usuario</h2>
      <button class="modal-close" onclick="closeModal('modalCrearUsuario')"
        >&times;</button
      >
    </div>
    <div class="modal-body">
      <form id="formCrearUsuario">
        <div class="form-row">
          <div class="form-group">
            <label for="nombre">Nombre Completo *</label>
            <input
              type="text"
              id="nombre"
              name="nombre"
              class="form-input"
              placeholder="Juan Pérez"
              required
            />
          </div>
          <div class="form-group">
            <label for="email">Email *</label>
            <input
              type="email"
              id="email"
              name="email"
              class="form-input"
              placeholder="juan@strop.com"
              required
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="telefono">Teléfono</label>
            <input
              type="tel"
              id="telefono"
              name="telefono"
              class="form-input"
              placeholder="+34 600 000 000"
            />
          </div>
          <div class="form-group">
            <label for="role">Rol en el Sistema *</label>
            <select id="role" name="role" class="form-select" required>
              <option value="">Selecciona un rol...</option>
              <option value="cabo">Cabo (Personal de Campo)</option>
              <option value="resident">Residente (Supervisor de Zona)</option>
              <option value="superintendent"
                >Superintendente (Jefe de Proyecto)</option
              >
              <option value="owner">Dueño / Administrador</option>
            </select>
            <p class="text-xs text-gray-500 mt-1">
              El rol define los permisos en la App Móvil.
            </p>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="ciudad">Ciudad</label>
            <input
              type="text"
              id="ciudad"
              name="ciudad"
              class="form-input"
              placeholder="Madrid"
            />
          </div>
          <div class="form-group">
            <label for="estado">Estado</label>
            <select id="estado" name="estado" class="form-select">
              <option value="Activo">Activo</option>
              <option value="Inactivo">Inactivo</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="password">Contraseña Inicial *</label>
          <input
            type="password"
            id="password"
            name="password"
            class="form-input"
            placeholder="••••••••"
            required
          />
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn-cancel"
        onclick="closeModal('modalCrearUsuario')">Cancelar</button
      >
      <button type="submit" form="formCrearUsuario" class="btn-submit"
        >Crear Usuario</button
      >
    </div>
  </div>
</div>

<script>
  // Declare global functions
  declare global {
    interface Window {
      openModal: (modalId: string) => void;
      closeModal: (modalId: string) => void;
    }
  }

  window.openModal = function (modalId: string) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.add("show");
      document.body.style.overflow = "hidden";
    }
  };

  window.closeModal = function (modalId: string) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.remove("show");
      document.body.style.overflow = "";
    }
  };

  // Close modal on overlay click
  document.addEventListener("DOMContentLoaded", function () {
    const modalOverlays = document.querySelectorAll(".modal-overlay");
    modalOverlays.forEach((overlay) => {
      overlay.addEventListener("click", function (e: Event) {
        if (e.target === overlay) {
          overlay.classList.remove("show");
          document.body.style.overflow = "";
        }
      });
    });

    // Handle form submission
    const form = document.getElementById(
      "formCrearUsuario"
    ) as HTMLFormElement | null;
    if (form) {
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        console.log("Crear usuario:", data);
        // TODO: Enviar datos al API
        alert(`Usuario "${data.nombre}" creado exitosamente!`);
        window.closeModal("modalCrearUsuario");
        form.reset();
      });
    }
  });
</script>
