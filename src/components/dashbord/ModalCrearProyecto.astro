<!-- Modal Crear Proyecto -->
<div class="modal-overlay" id="modalCrearProyecto">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Crear Nuevo Proyecto</h2>
      <button
        class="modal-close"
        onclick="closeModalProyecto('modalCrearProyecto')">&times;</button
      >
    </div>
    <div class="modal-body">
      <form id="formCrearProyecto">
        <div class="form-group">
          <label for="titulo">Nombre del Proyecto *</label>
          <input
            type="text"
            id="titulo"
            name="titulo"
            class="form-input"
            placeholder="Residencial del Valle"
            required
          />
        </div>

        <div class="form-group">
          <label for="clientName">Cliente (Razón Social) *</label>
          <input
            type="text"
            id="clientName"
            name="clientName"
            class="form-input"
            placeholder="Inmobiliaria X"
            required
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="address">Dirección Exacta (Calle y #) *</label>
            <input
              type="text"
              id="address"
              name="address"
              class="form-input"
              placeholder="Av. Reforma 123"
              required
            />
          </div>
          <div class="form-group">
            <label for="location">Ciudad / Estado *</label>
            <input
              type="text"
              id="location"
              name="location"
              class="form-input"
              placeholder="CDMX"
              required
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="fechaInicio">Fecha de Inicio</label>
            <input
              type="date"
              id="fechaInicio"
              name="fechaInicio"
              class="form-input"
            />
          </div>
          <div class="form-group">
            <label for="fechaFin">Fecha de Finalización</label>
            <input
              type="date"
              id="fechaFin"
              name="fechaFin"
              class="form-input"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="superintendentId">Superintendente a Cargo (Jefe)</label>
          <select
            id="superintendentId"
            name="superintendentId"
            class="form-select"
            required
          >
            <option value="">Seleccione un ingeniero...</option>
            <option value="1">Carlos Rivera</option>
            <option value="2">Ana Torres</option>
            <option value="3">Luis García</option>
            <option value="4">Javier Martín</option>
          </select>
        </div>

        <div class="form-group">
          <label for="descripcion">Descripción</label>
          <textarea
            id="descripcion"
            name="descripcion"
            class="form-textarea"
            placeholder="Describe el proyecto..."></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn-cancel"
        onclick="closeModalProyecto('modalCrearProyecto')">Cancelar</button
      >
      <button type="submit" form="formCrearProyecto" class="btn-submit"
        >Crear Proyecto</button
      >
    </div>
  </div>
</div>

<script>
  // Declare global functions
  declare global {
    interface Window {
      openModalProyecto: (modalId: string) => void;
      closeModalProyecto: (modalId: string) => void;
    }
  }

  window.openModalProyecto = function (modalId: string) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.add("show");
      document.body.style.overflow = "hidden";
    }
  };

  window.closeModalProyecto = function (modalId: string) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.remove("show");
      document.body.style.overflow = "";
    }
  };

  // Close modal on overlay click
  document.addEventListener("DOMContentLoaded", function () {
    const modalOverlays =
      document.querySelectorAll<HTMLElement>(".modal-overlay");
    modalOverlays.forEach((overlay) => {
      overlay.addEventListener("click", function (e: Event) {
        if (e.target === overlay) {
          overlay.classList.remove("show");
          document.body.style.overflow = "";
        }
      });
    });

    // Handle form submission
    const form = document.getElementById(
      "formCrearProyecto"
    ) as HTMLFormElement | null;
    if (form) {
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        // Construir objeto alineado con ProjectModel del móvil
        const payload = {
          id: String(Date.now()),
          name: (data as any).titulo,
          clientName: (data as any).clientName,
          address: (data as any).address,
          location: (data as any).location,
          superintendentId: (data as any).superintendentId || null,
          startDate: (data as any).fechaInicio || null,
          estimatedEndDate: (data as any).fechaFin || null,
          description: (data as any).descripcion || "",
          status: "active",
          progress: 0,
          teamCount: 0,
          openIncidents: 0,
          pendingApprovals: 0,
        };

        console.log("Crear proyecto (payload):", payload);
        // TODO: Enviar payload al API
        alert(`Proyecto "${payload.name}" creado exitosamente!`);
        window.closeModalProyecto("modalCrearProyecto");
        form.reset();
      });
    }
  });
</script>
